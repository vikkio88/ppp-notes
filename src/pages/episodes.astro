---
import fs from "node:fs";
import Layout from "../layouts/Layout.astro";
import Accordion from "../components/shared/Accordion.astro";

type Episode = {
    title: string;
    pubDate: string;
    fileUrl: string;
    content: string;
    contentSnippet: string;
    guid: string;
    isoDate: string;
};
const episodes = JSON.parse(
    fs.readFileSync(`output/${import.meta.env.PUBLIC_EPISODES_URL}`).toString(),
) as Episode[];
---

<Layout>
    <div class="results">
        {episodes.map((e) => <Accordion episode={e} />)}
    </div>
    <script lang="ts" is:inline>
        function info(dialogId) {
            //: string) {
            const dialog = document.getElementById(dialogId);
            // as
            //   | HTMLDialogElement
            //   | undefined;
            console.log(dialog, dialogId);
            if (dialog) {
                dialog.showModal();
                dialog.addEventListener("click", (e) => {
                    const dialogDimensions = dialog.getBoundingClientRect();
                    if (
                        e.clientX < dialogDimensions.left ||
                        e.clientX > dialogDimensions.right ||
                        e.clientY < dialogDimensions.top ||
                        e.clientY > dialogDimensions.bottom
                    ) {
                        dialog.close();
                    }
                });
                const dialogExit = document.getElementById(`close-${dialogId}`);
                if (dialogExit) {
                    dialogExit.addEventListener("click", () => dialog.close());
                }
            }
        }
    </script>
</Layout>
